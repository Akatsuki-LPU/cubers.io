{% extends "user/settings/base.html" %}

{% block head %}
{{ super() }}
{% endblock %}

{% block content %}
<canvas id="shapes"></canvas>
<div class="cubers-container">
    <div class="container">
        <div class="row mb-3 mt-3">
            <div class="col-10 offset-1 text-center settings-header">
                <h3>Custom Color Settings for {{ header_msg[0] }}</h3>
                {% if not is_mobile %}
                <span>{{ header_msg[1] }}</span>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-10 offset-1">
                {% for setting in settings %}
                    {% if setting.type == 'boolean' %}
                    {% include 'user/settings/boolean_setting.html' %}
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <div class="row flex-center-all">
            {% for setting in settings %}
                {% if setting.type == 'hex_color' %}{% include 'user/settings/color_setting.html' %}{% endif %}
            {% endfor %}
        </div>
        <div class="row flex-center-all mb-3 mt-3">
            {% if is_mobile %}
            <div class="col-8 scramble_preview no_pointer">
                <div style="background-color: white; border-radius: 10px; padding: 20px;">
                    <canvas id="normal_scramble_image"></canvas>
                </div>
            </div>
            {% else %}
            <div class="col-5 scramble_preview no_pointer">
                <div style="background-color: white; border-radius: 10px; padding: 20px;">
                    <canvas id="normal_scramble_image"></canvas>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}


{% block additional_script %}
{{ super() }}
<script>
    $(function () {
        $(".colorpicker").spectrum({
            preferredFormat: "hex",
            allowEmpty: false,
            showInput: true,
            showInitial: true,
            showPalette: true,
            {% if disabled_settings %}
            disabled: true,
            {% endif %}
            palette: {{ default_colors | tojson }},
            showButtons: false
        });

        var updateColor = function(e, color) {
            var color_setting = {};
            color_setting[this.name] = color.toHexString();

            $.ajax({
                url: '/settings/save',
                type: "POST",
                data: JSON.stringify(color_setting),
                contentType: "application/json",
                error: function(xhr) {
                    bootbox.alert("Something unexpected happened: " + xhr.responseText);
                }
            });
        };

        $(".colorpicker").on('dragstop.spectrum', updateColor);
        $(".colorpicker").on('change', updateColor);

        window.app.settings_data = {};
        window.app.userSettingsManager = new window.app.UserSettingsManager();
        window.app.isMobile = {{ is_mobile | tojson }};

        window.app.scramble = "";
        window.app.eventName = "3x3";

        var imageGenerator = new window.app.ScrambleImageGenerator();
        imageGenerator.prepareNewImage();
    })
</script>
{% endblock %}