{% extends "common/base.html" %}

{% block head %}
    {{ super() }}
{% endblock %}

{% block content %}
    <div class="container">
        <div class="card text-center my-2">
            <div class="card-body">
                <h4 class="card-title">/r/cubers Weekly Competition!</h5>
                <a class="card-text">some sort of intro/explanation/welcome here</a>
            </div>
        </div>
        <div id="card-time-entry" class="card text-center">
            <div class="card-header pb-0">
                <!--
                <ul id="event-tabs" class="nav nav-tabs nav-scroll ultra-hidden">
                    {% for competition_event in current_competition.events %}
                        <li class="nav-item">
                            <a class="event-tab nav-link {% if loop.index0 == 0 %} active {% endif %}" href="#{{ competition_event.Event.name }}" data-competition-event-id="{{ competition_event.id }}" data-toggle="tab" aria-controls="{{ competition_event.Event.name }}" aria-selected="true">{{ competition_event.Event.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
                <ul id="timer-event-tabs" class="nav nav-tabs nav-scroll">
                    {% for competition_event in current_competition.events %}
                        <li class="nav-item">
                            <a class="event-tab nav-link {% if loop.index0 == 0 %} active {% endif %}" href="#timer-{{ competition_event.Event.name }}" data-competition-event-id="{{ competition_event.id }}" data-toggle="tab" aria-controls="{{ competition_event.Event.name }}" aria-selected="true">{{ competition_event.Event.name }}</a>
                        </li>
                    {% endfor %}
                </ul>
                -->
                <div class="row justify-content-center">
                    {% for competition_event in current_competition.events %}
                        <div class="col-2 mb-5">
                            <div class="event-card card">
                                <div style="position: relative;">
                                    <div class="card-img-top py-3" style="min-height: 153px">
                                        <img src="./static/images/cube-{{ competition_event.Event.id }}.png">
                                    </div>
                                    <div class="card-img-top py-3 selected-image" style="position: absolute; top: 0; left: 0; min-height: 153px">
                                        <img src="./static/images/cube-{{ competition_event.Event.id }}-selected.png">
                                    </div>
                                </div>
                                <div class="card-body pt-0 pb-1">
                                    <hr class="my-0">
                                    <h5 class="card-title mt-2">{{ competition_event.Event.name }}</h5>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div class>
            </div>
            <div class="card-body" style="padding-left: 3px; padding-right: 3px">
                <div id="dv-manual" style="display: none">
                    <div class="tab-content" style="margin-bottom: 20px">
                        {% for competition_event in current_competition.events %}
                        <div class="tab-pane fade {% if loop.index0 == 0 %} show active {% endif %}" id="{{ competition_event.Event.name }}" role="tabpanel" aria-labelledby="{{ competition_event.Event.name }}-tab">
                            <div class="row justify-content-center">
                                <div class="col-12 col-md-10 col-lg-8">
                                    <div class="container">
                                        <div class="justify-content-between form-group form-inline px-3">
                                            <label for="btn-switch-mode" style="font-size: 1.5rem">{{ competition_event.Event.name }}</label>
                                            <button class="btn-switch-mode btn btn-outline-secondary">Switch to Timer</button>
                                        </div>
                                    </div>
                                    <hr>
                                    <div class="scrambles">
                                        {% for scramble in competition_event.scrambles %}
                                            <div class="scramble" data-scramble-id="{{ scramble.id }}" data-scramble-num="{{ loop.index }}">
                                                <div class="container">
                                                    <div class="row justify-content-center">
                                                        <div class="scramble-num col-1 col-sm-2 col-md-1 col-lg-1" style="text-align: center"><span style="overflow-wrap: normal; padding-left: 5px;">{{ loop.index }}.</span></div>
                                                        <div class="col-8 col-sm-9 col-md-8 col-lg-8"><span>{{ scramble.scramble }}</span></div>
                                                        <div class="dv-scramble-time col-4 col-sm-3 col-md-3 col-lg-3" style="text-align: left"><span class="scramble-time" style="overflow-wrap: normal; padding-right: 5px"></span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="row justify-content-center">
                        <div class="input-group col-12 col-md-10 col-lg-7">
                            <div class="input-group-prepend">
                                <button class="btn btn-plus-two" type="button">+2</button>
                                <button class="btn btn-outline-danger btn-dnf" type="button">DNF</button>
                            </div>
                            <input id="input-time" type="text" class="form-control" placeholder="Time for Scramble 1" area-label"Time for Scramble 1">
                            <div class="input-group-append">
                                <button id="btn-enter-time" class="btn btn-cubers-primary-outline" type="button">Enter</button>
                            </div>
                            <div class="invalid-feedback">
                                Invalid time 
                            </div>
                        </div>
                    </div>
                </div>
                <div id="dv-timer">
                    <div class="tab-content" style="margin-bottom: 20px">
                        {% for competition_event in current_competition.events %}
                        <div class="tab-pane fade {% if loop.index0 == 0 %} show active {% endif %}" id="timer-{{ competition_event.Event.name }}" role="tabpanel" aria-labelledby="{{ competition_event.Event.name }}-tab">
                            <div class="row justify-content-center">
                                <div class="col-12 col-md-10 col-lg-8">
                                    <div class="container">
                                        <div class="justify-content-between form-group form-inline px-3">
                                            <label for="btn-switch-mode" style="font-size: 1.5rem">{{ competition_event.Event.name }}</label>
                                            <button class="btn-switch-mode btn btn-outline-secondary">Switch to Manual</button>
                                        </div>
                                    </div>
                                    <hr>
                                </div>
                                <div class="w-100"></div>
                                <div class="col-12 col-md-10 col-lg-11">
                                    <div class="dv-scrambles-dropdown btn-group">
                                        <button class="btn-scrambles btn btn-secondary btn-lg dropdown-toggle" type="button" data-event-id="{{ competition_event.id }}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                            1. {{ competition_event.scrambles[0].scramble }}
                                        </button>
                                        <div class="scrambles-dropdown dropdown-menu" style"display: block">
                                            {% for scramble in competition_event.scrambles %}
                                                <a class="dropdown-item" aria-labelledby="Scramble {{ loop.index1 }}" data-scramble-id="{{ scramble.id }}">{{ loop.index }}. {{ scramble.scramble }}</a>
                                            {% endfor %}
                                        </div>
                                    </div>
                                </div>
                                <div class="w-100 mb-4"></div>
                                <div class="timer-start-zone w-100">
                                    <span class="timer-time">
                                        ready
                                    </span>
                                </div>
                                <div class="w-100 mb-4"></div>
                                <div class="col-lg-12 col-md-10 col-sm-9 col-9">
                                    <button class="btn btn-lg btn-plus-two timer-btn" type="button">+2</button>
                                    <button class="btn btn-lg btn-outline-danger btn-dnf timer-btn" type="button">DNF</button>
                                </div>
                                <div class="w-100 mb-4"></div>
                                <div class="col-lg-12 col-md-10 col-sm-9 col-9">
                                    {% for scramble in competition_event.scrambles %}<span id="timer-result-{{ scramble.id }}" class="result card" data-scramble-id="{{ scramble.id }}"><span class="num text-muted">{{ loop.index }}. </span><span class="value-holder"></span></span>{% endfor %}
                                    <p id="timer-helper-text" class="text-muted">Select a time or scramble to modify the result or retime.</p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="card-footer text-muted">
                <div class="row justify-content-center">
                    <div class="input-group col-12 col-md-10 col-lg-8 row justify-content-center">
                        <h5 class="col-11 text-center">Press the button below to proceed to submission or save your results for later.</h5>
                        <button id="btn-continue" class="btn btn-lg btn-outline-success col-lg-3 col-md-5 col-sm-8 col-11" style="margin-left: auto; margin-right: auto; margin-top: 10px">Continue</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="card-submit" class="card text-center" style="display: none">
            <div class="card-body">
                <h4 class="card-title">Overview</h4>
                <div class="d-flex align-items-center" style="min-height: 220px;">
                    <div style="width: 100%;">
                        <div class="row justify-content-center px-3">
                            <ul id="overview" class="list-group col-12 col-md-10 col-lg-8" style="padding: 0px"></ul>
                        </div>
                        <h6 style="margin-top: 5px">Spot an error? Click on an event to correct it!</h6>
                    </div>
                </div>
                <hr>
                <h5>Click Submit to submit your results to be scored.</h5>
                <p class="mb-1">Don't worry, it's not permanent. You can come back and edit your results or compete in a new event.</p>
                <p id="unfinished-events-warning" class="mb-1 text-danger">You have unfinished events! They will be saved, but they will not be scored!</p>
                <div class="row justify-content-center" style="margin-top: 25px;">
                    <div class="col-sm-5 col-md-4 col-lg-3" style="margin-bottom: 5px;">
                        <button id="btn-cancel-submit" class="btn btn-lg btn-outline-secondary" style="width: 100%">Cancel</button>
                    </div>
                    <div class="col-sm-5 col-md-4 col-lg-3">
                        <form action="/submit" method="POST" id="form-results" style="display: none">
                            <input type="hidden" id="input-results" />
                        </form>
                        <button id="btn-submit" class="btn btn-lg btn-success" style="width: 100%">Submit</button>
                    </div>  
                </div>
            </div>
        </div>
    </div>

    {% assets "timer_js" %}
        <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
    <script>
        {% for competition_event in current_competition.events %}
        addEvent({{ competition_event.id }}, "{{ competition_event.Event.name }}");

        {% for scramble in competition_event.scrambles %}
        addScramble({{ competition_event.id }}, {{ scramble.id }}, "{{ scramble.scramble }}");
        {% endfor %}
        {% endfor %}

        $(document).ready(function() {
            //onTabSwitch({{ current_competition.events[0].id }});
        });
    </script>
{% endblock %}